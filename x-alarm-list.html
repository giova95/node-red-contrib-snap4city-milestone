<!--/* NODE-RED-CONTRIB-SNAP4CITY-MILESTONE
   Copyright (C) 2023 DISIT Lab http://www.disit.org - University of Florence

   This program is free software: you can redistribute it and/or modify
   it under the terms of the GNU Affero General Public License as
   published by the Free Software Foundation, either version 3 of the
   License, or (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU Affero General Public License for more details.

   You should have received a copy of the GNU Affero General Public License
   along with this program.  If not, see <http://www.gnu.org/licenses/>. */-->

<script type="text/javascript">
    RED.nodes.registerType('x-alarm-list', {
        category: 'S4CMilestone',
        color: '#fde910',
        icon: 'icons/logocam.png',
        inputs: 1,
        outputs: 1,
        label: 'Print Alarm List From XProtect',
        defaults: {
            maxLines: { type: 'text' },
            order: { type: 'text' },
            target: { type: 'text' },
        }
    });
</script>

<script type="text/html" data-template-name="x-alarm-list">
    <div class="form-row">
        <label for="node-input-maxLines"><i class="fa fa-tag"></i>Max lines</label>
        <input type="text" id="node-input-maxLines" placeholder="Max lines">
    </div>
    <div class="form-row">
        <label for="node-input-order"><i class="fa fa-tag"></i>Order</label>
        <select id="node-input-order" type="text">
            <option value ="Descending">Descending</option>
            <option value="Ascending">Ascending</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-target"><i class="fa fa-tag"></i>Target</label>
        <select id="node-input-target" type="text">
            <option value="LocalId">Id</option>
            <option value="Timestamp">Timestamp</option>
            <option value="StateName">StateName</option>
            <option value="SourceName">SourceName</option>
            <option value="Type">Type</option>
        </select>
    </div>
</script>

<script type="text/x-red" data-help-name="x-alarm-list">
    <p>With this node you can send an event to the event server and trigger an Alarm with the possibility to activate a rule associated with it.</p>
    
    <h3>Inputs</h3>
    <p>A JSON with these parameters:</p>
    
    <dl class="message-properties">
       <dt>maxLines
           <span class="property-type">number(compulsory)</span>
       </dt>
       <dd>Max lines of alarm to display from the event server</dd>
       
       <dt>order
           <span class="property-type">string(compulsory)</span>
       </dt>
       <dd>The sorting type for the alarms.(Basically descending/ascending displayed in a drop-down menu in node properties).</dd>
       
       <dt>target
            <span class="property-type">string(compulsory)</span>
       </dt>
       <dd>The target property of the sorting for the alarms.(They're displayed with a drop-down menu in node properties).</dd>
    </dl>

    <h3>Outputs</h3>
    <p>A JSON object with an array which contains an alarm for each item, if the node works, with these informations:</p>

     <dl class="message-properties">
        <dt>CameraId
            <span class="property-type">string</span>
        </dt>
        <dd>The Id of the camera corresponding to the alarm/event</dd>
     </dl>
     <dl class="message-properties">
        <dt>Description
            <span class="property-type">string</span>
        </dt>
        <dd>A short description of the alarm/event</dd>
     </dl>
     <dl class="message-properties">
        <dt>Id
            <span class="property-type">string</span>
        </dt>
        <dd>The Id associated with the alarm/event</dd>
     </dl>
    
    <p>A JSON object with this parameter, if the node doesn't work:</p> 
    <dl class="message-properties">
        <dt>error
            <span class="property-type">string</span>
        </dt>
        <dd>The type of error generated by the operation</dd>
        
        <dt>description
            <span class="property-type">string</span>
        </dt>
        <dd>A more accurate description to help resolve the issue</dd>
     </dl>
    
    <h3>Example of JSON output if the operation goes wrong</h3>
        <pre>
            {
                error: "500 Internal Server Error",
                description: "InnerException The value 'wrong' cannot be parsed as the type 'Int32'"
            };
        </pre>

    <h3>Details</h3>
     <p>The node can receive the parameters described in the Inputs section, with them generates a XML file with which a SOAP request is sent to the event server. 
        A server response with the alarm list generates the output JSON. If the values are not present in the input JSON, these are read by those in the node properties. 
        If they are not present in either part or are wrong, an error is generated for the necessary parameters or the reason why are not correct.</p>
</script>